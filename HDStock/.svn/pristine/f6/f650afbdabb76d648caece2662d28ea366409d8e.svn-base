//
//  HDMarketDetailViewController.m
//  HDStock
//
//  Created by liyancheng on 16/11/23.
//  Copyright © 2016年 hd-app02. All rights reserved.
//

#import "HDMarketDetailViewController.h"
#import "HDMarkerDetailFirstTableViewCell.h"
#import "MarkerSecondTableViewCell.h"
#import "MarketThirdTableViewCell.h"
#import "bottonImageButton.h"
#import <WebKit/WebKit.h>

#define realWidth [[UIScreen mainScreen] bounds].size.width
#define realHeight [[UIScreen mainScreen] bounds].size.height
@interface HDMarketDetailViewController ()<UITableViewDelegate,UITableViewDataSource>
@property (nonatomic,copy) UITableView * tableView;
@property (nonatomic,strong) WKWebView * webView;
@end

@implementation HDMarketDetailViewController{

    UIView * navView;
}

-(void)viewWillAppear:(BOOL)animated{
    [super viewWillAppear:animated];
    [self.navigationController setNavigationBarHidden:NO animated:NO];
//    [self setNavigation];
}

- (void)viewDidLoad {
    [super viewDidLoad];
    NSString *urlStr = [NSString stringWithFormat:@"%@%@",@"http://tzb.cndzsp.com/klink_m2/?securityID=",[_codeStr substringWithRange:NSMakeRange(_codeStr.length-6, 6)]];
    [self setNavCustemViewForLeftItemWithImage:imageNamed(@"Live_back") title:@"返回" titleFont:[UIFont systemFontOfSize:(15)] titleCoclor:[UIColor clearColor] custemViewFrame:CGRM(0, 26, 56, 44)];
    [self.webView loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:urlStr]]];
}

-(WKWebView *)webView{
    if(_webView == nil){
        _webView = [[WKWebView alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT-64)];
        [self.view addSubview:_webView];
    }
    return _webView;
}

//- (void)setNavigation{
//    
//    self.navigationController.navigationBar.tintColor = [UIColor whiteColor];
//    navView = [[UIView alloc]initWithFrame:CGRectMake(SCREEN_WIDTH/2-100, 0, 200, 44)];
//    UILabel *titleLabel = [[UILabel alloc]initWithFrame:CGRectMake(0, 10, 200, 15)];
//    titleLabel.text = @"圣阳股份";
//    titleLabel.font = [UIFont systemFontOfSize:13];
//    titleLabel.textColor = [ UIColor whiteColor];
//    titleLabel.textAlignment = NSTextAlignmentCenter;
//    
//    
//    UILabel *stateLabel = [[UILabel alloc]initWithFrame:CGRectMake(0, 27, 200, 13)];
//    stateLabel.text = @"交易中 11-21 09:42";
//    stateLabel.font = [UIFont systemFontOfSize:11];
//    stateLabel.textColor = RGBCOLOR(183, 212, 236);
//    stateLabel.textAlignment = NSTextAlignmentCenter;
//    
//    [navView addSubview:titleLabel];
//    [navView addSubview:stateLabel];
//    
////    self.navigationItem.titleView = navView;
//    
//    [self.navigationController.navigationBar addSubview:navView];
//    
//    NSLog(@"%f",self.navigationItem.titleView.frame.origin.x);
//}

- (void)setBottomView{
    UIView *bottomView = [[UIView alloc]initWithFrame:CGRectMake(0, realHeight-45, realWidth, 45)];
    bottomView.backgroundColor = RGBCOLOR(221, 221, 221);
    bottonImageButton * button = [[bottonImageButton alloc]initWithFrame:CGRectMake(0, 0, realWidth/3-1, 41)];
    UIView *lineView = [[UIView alloc]initWithFrame:CGRectMake(CGRectGetMaxX(button.frame), 9, 1, 23)];
    [button setTitle:@"问股" forState:UIControlStateNormal];
    lineView.backgroundColor = RGBCOLOR(204, 204, 204);
    [bottomView addSubview:button];
    [bottomView addSubview:lineView];
    
    bottonImageButton * button1 = [[bottonImageButton alloc]initWithFrame:CGRectMake(CGRectGetMaxX(lineView.frame), 0, realWidth/3-1, 41)];
    UIView *lineView1 = [[UIView alloc]initWithFrame:CGRectMake(CGRectGetMaxX(button1.frame), 9, 1, 23)];
    [button1 setTitle:@"提醒" forState:UIControlStateNormal];
    lineView1.backgroundColor = RGBCOLOR(204, 204, 204);
    [bottomView addSubview:button1];
    [bottomView addSubview:lineView1];
    
    bottonImageButton * button2 = [[bottonImageButton alloc]initWithFrame:CGRectMake(CGRectGetMaxX(lineView1.frame), 0, realWidth/3, 41)];
    [bottomView addSubview:button2];
    [button2 setTitle:@"加入自选" forState:UIControlStateNormal];
    [self.view addSubview:bottomView];
}

-(void)setUpTableView{
    _tableView = [[UITableView alloc]initWithFrame:CGRectMake(0, 0, realWidth, realHeight-45)];
    _tableView.backgroundColor = BACKGROUNDCOKOR;
    _tableView.delegate = self;
    _tableView.dataSource = self;
    _tableView.separatorStyle = UITableViewCellSeparatorStyleNone;
    [_tableView registerNib:[UINib nibWithNibName:@"HDMarkerDetailFirstTableViewCell" bundle:nil] forCellReuseIdentifier:@"HDMarkerDetailFirstTableViewCell"];
    [_tableView registerNib:[UINib nibWithNibName:@"MarkerSecondTableViewCell" bundle:nil] forCellReuseIdentifier:@"MarkerSecondTableViewCell"];
    [_tableView registerNib:[UINib nibWithNibName:@"MarketThirdTableViewCell" bundle:nil] forCellReuseIdentifier:@"MarketThirdTableViewCell"];
    [self.view addSubview:_tableView];
    [_tableView reloadData];
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    if(section==0||section==1){
        return 1;
    }else{
        return 10;
    }
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    if(indexPath.section ==0){
        HDMarkerDetailFirstTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"HDMarkerDetailFirstTableViewCell"];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
        return cell;
    }else if (indexPath.section ==1){
        MarkerSecondTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"MarkerSecondTableViewCell"];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
        return cell;
    }else if (indexPath.section ==2){
        MarketThirdTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"MarketThirdTableViewCell"];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
        cell.tempFlag = @"股评天下:炒高送转题材要避免4个误区";
        return cell;
    }
    else
    return nil;
}


-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    if(indexPath.section == 0){
        return 200;
    }
    else if (indexPath.section == 1){
        return 300;
    }
    else if (indexPath.section == 2){
        return 49*realWidth/375;
    }
    else{
        return 0;
    }
}

-(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView{
    return 3;
}

-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{
    if(section == 2){
        return 41;
    }else{
        return 0;
    }
}

-(UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section{
    UIView * tableHeadView = [[UIView alloc]initWithFrame:CGRectMake(0, 64, realWidth, 43)];
    //    tableHeadView.backgroundColor = UICOLOR(102, 102, 102, 1);
    tableHeadView.backgroundColor = BACKGROUNDCOKOR;
    UILabel * titleLable = [[UILabel alloc]initWithFrame:CGRectMake(20, 15, 100, 15)];
    titleLable.textColor = UICOLOR(51, 51, 51, 1);
    titleLable.font = [UIFont systemFontOfSize:15];
    titleLable.text = @"新闻";
    titleLable.textAlignment = NSTextAlignmentLeft;
    [tableHeadView addSubview:titleLable];
    return tableHeadView;
}

-(void)viewWillDisappear:(BOOL)animated{
    [super viewWillDisappear:animated];
    [navView removeFromSuperview];
}


@end
